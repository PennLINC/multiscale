---
title: "Untitled"
author: "Adam"
date: "10/16/2020"
output: html_document
---

```{r}
library(ggplot2)
library(ggpointdensity)
library(ggridges)
library(reshape2)

L=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/vertexWiseChange_LH.csv')
R=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/vertexWiseChange_RH.csv')

# initialize vectors
spatCorvec_L<-rep(0,30)
spatCorvec_R<-rep(0,30)
spatCorvec<-rep(0,30)

for (K in 2:30){
  x=data.frame(c(L[,K],R[,K]),c(L[,1],R[,1]))
  colnames(x)<-c('LoadingChange','GradChange')
  print(ggplot(x,aes(x=LoadingChange,y=GradChange)) + geom_pointdensity(adjust=.001) + scale_color_viridis_c())
  # definitely not normally distr.
  spatCorvec_R[K]<-cor.test(R[,K],R[,1],method='spearman')$estimate
  spatCorvec_L[K]<-cor.test(L[,K],L[,1],method='spearman')$estimate
  spatCorvec[K]<-cor.test(x$LoadingChange,x$GradChange,method='spearman')$estimate
}
#for (K in 2:30){
#  x=data.frame(L[,K],L[,1])
#  colnames(x)<-c('LoadingChange','GradChange')
#  print(ggplot(x,aes(x=LoadingChange,y=GradChange)) + geom_pointdensity(adjust=.001) + scale_color_viridis_c())
#  plot(L[,K],L[,1],ylim=c(0,4))
  # definitely not normally distr.
#  spatCorvec_L[K-1]<-cor.test(L[,K],L[,1],method='spearman')$estimate
#}

# get z-scores of grad change
zscoredGradChange<-scale(c(L[,1],R[,1]))

# save the z-scored dif
for (K in 2:30){
  # get z-score of community change at this scale
  zcoredCommChange<-scale(c(L[,K],R[,K]))
  zScoredDif<-zscoredGradChange-zcoredCommChange
  spatChangL<-zScoredDif[1:(dim(L)[1])]
  spatChangR<-zScoredDif[((dim(L)[1])+1):((dim(L)[1])+dim(R)[1])]
  fn<-paste('/cbica/projects/pinesParcels/results/aggregated_data/spatChangeZDif_K_',K,'.csv',sep='')
  write.table(c(spatChangL,spatChangR),fn,sep=',', col.names = F,quote = F,row.names=F)
}

plot(spatCorvec)
```

```{r}
# color vector for highlighting 4 different scales
grayHexa<-'#a19f9f'
fourscalescheme<-rep(grayHexa,29)
# scale 4 - purple
fourscalescheme[3]<-'#490091'
# scale 7 - yellow
#fourscalescheme[6]<- '#FFCC00'
# scale 13 - black
fourscalescheme[12]<- '#cca300' 
# scale 20 - red
fourscalescheme[19]<- '#a30000'
  
# load in spin test distributions
spinDistr<-read.csv('/cbica/projects/pinesParcels/results/aggregated_data/SpinTestDistrs_MAD.csv')

# melt this into 1001*29 columns 
m_spinDistr<-melt(spinDistr)

# add a "scale" column
m_spinDistr$Scale<-rep(2:30,each=1001)
# add a "realCor" boolean column
repeatVector<-array(0,dim=c(1001,1))
repeatVector[1]<-1
m_spinDistr$RealCor<-rep(rep(c(1,0),c(1,1000)),times=29)
m_spinDistr$Scale<-as.factor(m_spinDistr$Scale)
ggplot(m_spinDistr[m_spinDistr$RealCor==0,], aes(x = value, y = Scale, group = Scale))+xlab(expression(rho)) + geom_jitter(size = 0.75,alpha=.15) +geom_point(data=m_spinDistr[m_spinDistr$RealCor==1,],aes(x=value,y=Scale),size=3)+scale_fill_manual(values=fourscalescheme)+theme_minimal(base_size = 17)+coord_flip()+theme(legend.position = "none")+xlim(c(-.285,.85))+ylab('# of Communities')

# load in spin test distributions
spinDistr_PG<-read.csv('/cbica/projects/pinesParcels/results/aggregated_data/SpinTestDistrs_MAD_PG.csv')

# melt this into 1001*29 columns 
m_spinDistr<-melt(spinDistr_PG)

# add a "scale" column
m_spinDistr$Scale<-rep(2:30,each=1001)
# add a "realCor" boolean column
repeatVector<-array(0,dim=c(1001,1))
repeatVector[1]<-1
m_spinDistr$RealCor<-rep(rep(c(1,0),c(1,1000)),times=29)
m_spinDistr$Scale<-as.factor(m_spinDistr$Scale)
ggplot(m_spinDistr[m_spinDistr$RealCor==0,], aes(x = value, y = Scale, group = Scale))+xlab(expression(rho)) + geom_jitter(size = 0.75,alpha=.15) +geom_point(data=m_spinDistr[m_spinDistr$RealCor==1,],aes(x=value,y=Scale),size=3)+scale_fill_manual(values=fourscalescheme)+theme_minimal(base_size = 17)+coord_flip()+theme(legend.position = "none")+xlim(c(-.285,.85))+ylab('# of Communities')
```