---
title: "Untitled"
author: "Adam"
date: "11/5/2021"
output: html_document
---
```{r}
library(ggplot2)
library(forcats)
```

```{r}

# for reproducible permutations
set.seed(666)

### K=4
# rest + emoID
restEmo=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restEmoARI_K4.csv')
# convert to matrix
restEmoMat=data.matrix(restEmo)
# get index of upper triangle
UTI=upper.tri(restEmoMat)
# index of lower
LTI=lower.tri(restEmoMat)

# rest + nback
restNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restNbackARI_K4.csv')
# convert to matrix
restNbackMat=data.matrix(restNback)

# emoID + nback
EmoNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_EmoNbackARI_K4.csv')
# convert to matrix
EmoNbackMat=data.matrix(EmoNback)
```

```{r}
# intitialize difference in median vectors
permMedianDiff_RE=rep(0,1000)
permMedianDiff_RN=rep(0,1000)
permMedianDiff_EN=rep(0,1000)

# initialize permutation vectors for w/in subject selection (w/o replacement)
permutVecs=array(data=NA,dim=c(1000,693))
for (p in 1:1000){
  permutVecs[p,]=sample(1:480249,693,replace=F)
}
# calculate actual medians for each task
medRE_win=median(diag(restEmoMat))
medRN_win=median(diag(restNbackMat))
medEN_win=median(diag(EmoNbackMat))
medRE_bw=median(c(restEmoMat[UTI],restEmoMat[LTI]))
medRN_bw=median(c(restNbackMat[UTI],restNbackMat[LTI]))
medEN_bw=median(c(EmoNbackMat[UTI],EmoNbackMat[LTI]))
# get actual diff
RE_dif=medRE_win-medRE_bw
RN_dif=medRN_win-medRN_bw
EN_dif=medEN_win-medEN_bw
for (p in 1:1000){
  # pull out permutation vector for this iteration
  permutVec=permutVecs[p,]
  # get permuted within subject ARI for each task-rest pair
  pmedRE_win=median(restEmoMat[permutVec])
  pmedRN_win=median(restNbackMat[permutVec])
  pmedEN_win=median(EmoNbackMat[permutVec])
  # 479556 is number of off-diagonals in a 693*693 matrix, get two vectors to sample that many in the matrix (w/o replacement)
  bwPermut=sample(1:480249,479556)
  # sample equiv number to off-diagonals for permuted bw
  pmedRE_bw=median(restEmoMat[bwPermut])
  pmedRN_bw=median(restNbackMat[bwPermut])
  pmedEN_bw=median(EmoNbackMat[bwPermut])
  # get permuted between-subject ARI for each task-rest pair
  permMedianDiff_RE[p]=pmedRE_win-pmedRE_bw
  permMedianDiff_RN[p]=pmedRN_win-pmedRN_bw
  permMedianDiff_EN[p]=pmedEN_win-pmedEN_bw
}
# 1000 difs in med dif for RE
difReal_min_difPermut_RE_4=RE_dif-permMedianDiff_RE
# RN
difReal_min_difPermut_RN_4=RN_dif-permMedianDiff_RN
# EN
difReal_min_difPermut_EN_4=EN_dif-permMedianDiff_EN
```

```{r}
### K=7
# rest + emoID
restEmo=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restEmoARI_K7.csv')
# convert to matrix
restEmoMat=data.matrix(restEmo)

# rest + nback
restNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restNbackARI_K7.csv')
# convert to matrix
restNbackMat=data.matrix(restNback)

# emoID + nback
EmoNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_EmoNbackARI_K7.csv')
# convert to matrix
EmoNbackMat=data.matrix(EmoNback)
```

```{r}
# intitialize difference in median vectors
permMedianDiff_RE=rep(0,1000)
permMedianDiff_RN=rep(0,1000)
permMedianDiff_EN=rep(0,1000)

# calculate actual medians for each task
medRE_win=median(diag(restEmoMat))
medRN_win=median(diag(restNbackMat))
medEN_win=median(diag(EmoNbackMat))
medRE_bw=median(c(restEmoMat[UTI],restEmoMat[LTI]))
medRN_bw=median(c(restNbackMat[UTI],restNbackMat[LTI]))
medEN_bw=median(c(EmoNbackMat[UTI],EmoNbackMat[LTI]))
# get actual diff
RE_dif=medRE_win-medRE_bw
RN_dif=medRN_win-medRN_bw
EN_dif=medEN_win-medEN_bw
for (p in 1:1000){
  # pull out permutation vector for this iteration
  permutVec=permutVecs[p,]
  # get permuted within subject ARI for each task-rest pair
  pmedRE_win=median(restEmoMat[permutVec])
  pmedRN_win=median(restNbackMat[permutVec])
  pmedEN_win=median(EmoNbackMat[permutVec])
  # 479556 is number of off-diagonals in a 693*693 matrix, get two vectors to sample that many in the matrix (w/o replacement)
  bwPermut=sample(1:480249,479556)
  # sample equiv number to off-diagonals for permuted bw
  pmedRE_bw=median(restEmoMat[bwPermut])
  pmedRN_bw=median(restNbackMat[bwPermut])
  pmedEN_bw=median(EmoNbackMat[bwPermut])
  # get permuted between-subject ARI for each task-rest pair
  permMedianDiff_RE[p]=pmedRE_win-pmedRE_bw
  permMedianDiff_RN[p]=pmedRN_win-pmedRN_bw
  permMedianDiff_EN[p]=pmedEN_win-pmedEN_bw
}
# 1000 difs in med dif for RE
difReal_min_difPermut_RE_7=RE_dif-permMedianDiff_RE
# RN
difReal_min_difPermut_RN_7=RN_dif-permMedianDiff_RN
# EN
difReal_min_difPermut_EN_7=EN_dif-permMedianDiff_EN
```

```{r}
### K=13
# rest + emoID
restEmo=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restEmoARI_K13.csv')
# convert to matrix
restEmoMat=data.matrix(restEmo)

# rest + nback
restNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restNbackARI_K13.csv')
# convert to matrix
restNbackMat=data.matrix(restNback)

# emoID + nback
EmoNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_EmoNbackARI_K13.csv')
# convert to matrix
EmoNbackMat=data.matrix(EmoNback)
```

```{r}
# intitialize difference in median vectors
permMedianDiff_RE=rep(0,1000)
permMedianDiff_RN=rep(0,1000)
permMedianDiff_EN=rep(0,1000)

# calculate actual medians for each task
medRE_win=median(diag(restEmoMat))
medRN_win=median(diag(restNbackMat))
medEN_win=median(diag(EmoNbackMat))
medRE_bw=median(c(restEmoMat[UTI],restEmoMat[LTI]))
medRN_bw=median(c(restNbackMat[UTI],restNbackMat[LTI]))
medEN_bw=median(c(EmoNbackMat[UTI],EmoNbackMat[LTI]))
# get actual diff
RE_dif=medRE_win-medRE_bw
RN_dif=medRN_win-medRN_bw
EN_dif=medEN_win-medEN_bw
for (p in 1:1000){
  # pull out permutation vector for this iteration
  permutVec=permutVecs[p,]
  # get permuted within subject ARI for each task-rest pair
  pmedRE_win=median(restEmoMat[permutVec])
  pmedRN_win=median(restNbackMat[permutVec])
  pmedEN_win=median(EmoNbackMat[permutVec])
  # 479556 is number of off-diagonals in a 693*693 matrix, get two vectors to sample that many in the matrix (w/o replacement)
  bwPermut=sample(1:480249,479556)
  # sample equiv number to off-diagonals for permuted bw
  pmedRE_bw=median(restEmoMat[bwPermut])
  pmedRN_bw=median(restNbackMat[bwPermut])
  pmedEN_bw=median(EmoNbackMat[bwPermut])
  # get permuted between-subject ARI for each task-rest pair
  permMedianDiff_RE[p]=pmedRE_win-pmedRE_bw
  permMedianDiff_RN[p]=pmedRN_win-pmedRN_bw
  permMedianDiff_EN[p]=pmedEN_win-pmedEN_bw
}
# 1000 difs in med dif for RE
difReal_min_difPermut_RE_13=RE_dif-permMedianDiff_RE
# RN
difReal_min_difPermut_RN_13=RN_dif-permMedianDiff_RN
# EN
difReal_min_difPermut_EN_13=EN_dif-permMedianDiff_EN
```

```{r}
### K=20
# rest + emoID
restEmo=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restEmoARI_K20.csv')
# convert to matrix
restEmoMat=data.matrix(restEmo)

# rest + nback
restNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_restNbackARI_K20.csv')
# convert to matrix
restNbackMat=data.matrix(restNback)

# emoID + nback
EmoNback=read.csv('/cbica/projects/pinesParcels/results/aggregated_data/BwSubj_EmoNbackARI_K20.csv')
# convert to matrix
EmoNbackMat=data.matrix(EmoNback)
```

```{r}
# intitialize difference in median vectors
permMedianDiff_RE=rep(0,1000)
permMedianDiff_RN=rep(0,1000)
permMedianDiff_EN=rep(0,1000)

# calculate actual medians for each task
medRE_win=median(diag(restEmoMat))
medRN_win=median(diag(restNbackMat))
medEN_win=median(diag(EmoNbackMat))
medRE_bw=median(c(restEmoMat[UTI],restEmoMat[LTI]))
medRN_bw=median(c(restNbackMat[UTI],restNbackMat[LTI]))
medEN_bw=median(c(EmoNbackMat[UTI],EmoNbackMat[LTI]))
# get actual diff
RE_dif=medRE_win-medRE_bw
RN_dif=medRN_win-medRN_bw
EN_dif=medEN_win-medEN_bw
for (p in 1:1000){
  # pull out permutation vector for this iteration
  permutVec=permutVecs[p,]
  # get permuted within subject ARI for each task-rest pair
  pmedRE_win=median(restEmoMat[permutVec])
  pmedRN_win=median(restNbackMat[permutVec])
  pmedEN_win=median(EmoNbackMat[permutVec])
  # 479556 is number of off-diagonals in a 693*693 matrix, get two vectors to sample that many in the matrix (w/o replacement)
  bwPermut=sample(1:480249,479556)
  # sample equiv number to off-diagonals for permuted bw
  pmedRE_bw=median(restEmoMat[bwPermut])
  pmedRN_bw=median(restNbackMat[bwPermut])
  pmedEN_bw=median(EmoNbackMat[bwPermut])
  # get permuted between-subject ARI for each task-rest pair
  permMedianDiff_RE[p]=pmedRE_win-pmedRE_bw
  permMedianDiff_RN[p]=pmedRN_win-pmedRN_bw
  permMedianDiff_EN[p]=pmedEN_win-pmedEN_bw
}
# 1000 difs in med dif for RE
difReal_min_difPermut_RE_20=RE_dif-permMedianDiff_RE
# RN
difReal_min_difPermut_RN_20=RN_dif-permMedianDiff_RN
# EN
difReal_min_difPermut_EN_20=EN_dif-permMedianDiff_EN
```


```{r}
library(reshape2)
# combine
masterPlotDf<-data.frame(difReal_min_difPermut_RE_4,difReal_min_difPermut_RN_4,difReal_min_difPermut_EN_4,difReal_min_difPermut_RE_7,difReal_min_difPermut_RN_7,difReal_min_difPermut_EN_7,difReal_min_difPermut_RE_13,difReal_min_difPermut_RN_13,difReal_min_difPermut_EN_13,difReal_min_difPermut_RE_20,difReal_min_difPermut_RN_20,difReal_min_difPermut_EN_20)

# set column names
colnames(masterPlotDf)<-c('Sc. 4, Rest-Emo','Sc. 4, Rest-nB','Sc. 4, Emo-Nb','Sc. 7, Rest-Emo','Sc. 7, Rest-nB','Sc. 7, Emo-nB','Sc. 13, Rest-Emo','Sc. 13, Rest-nB','Sc. 13, Emo-nB','Sc. 20, Rest-Emo','Sc. 20, Rest-nB','Sc. 20, Emo-nB')

# make into long df
mPdfmelt<-melt(masterPlotDf)

ggplot(data = mPdfmelt, aes(x = fct_inorder(variable), y = value)) + geom_violin()+ylab('Median w/in - b/w ARI difference over Permuted')+xlab("# of Networks") +theme_classic(base_size=20)+geom_point(data=mPdfmelt,aes(x=fct_inorder(variable),y=value),size=1,alpha=.3)+scale_y_continuous(limits=c(0,.18))

```